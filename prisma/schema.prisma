generator client {
  provider = "prisma-client-js"
  output   = "../node_modules/.prisma/client"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DATABASE_URL_UNPOOLED")
}

model User {
  id            String            @id @default(cuid())
  email         String?           @unique
  name          String?
  phone         String?
  role          UserRole          @default(USER)
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt
  emailVerified DateTime?
  image         String?
  accounts      Account[]
  posts         Post[]
  properties    Property[]
  inquiries     PropertyInquiry[]
  sessions      Session[]
  favorites     Favorite[]
  viewHistory   ViewHistory[]
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token                  String?
  session_state             String?
  refresh_token_expires_in  Int?
  user                      User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

model Post {
  id             String       @id @default(cuid())
  title          String
  slug           String       @unique
  content        String
  excerpt        String?
  category       PostCategory
  status         PostStatus   @default(DRAFT)
  featuredImage  String?
  seoTitle       String?
  seoDescription String?
  publishedAt    DateTime?
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  authorId       String
  author         User         @relation(fields: [authorId], references: [id])
  tags           PostTag[]
}

model Tag {
  id    String    @id @default(cuid())
  name  String    @unique
  color String?
  posts PostTag[]
}

model PostTag {
  postId String
  tagId  String
  post   Post   @relation(fields: [postId], references: [id], onDelete: Cascade)
  tag    Tag    @relation(fields: [tagId], references: [id], onDelete: Cascade)

  @@id([postId, tagId])
}

model Video {
  id             String   @id @default(cuid())
  youtubeId      String   @unique
  title          String
  description    String?
  thumbnail      String
  duration       String?
  publishedAt    DateTime
  category       String?
  tags           String
  viewCount      Int?     @default(0)
  likeCount      Int?     @default(0)
  commentCount   Int?     @default(0)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
  seoTitle       String?
  seoDescription String?
}

model Company {
  id           String   @id @default(cuid())
  name         String
  description  String
  mission      String?
  vision       String?
  patents      String
  achievements String
  teamMembers  String
  updatedAt    DateTime @updatedAt
  createdAt    DateTime @default(now())
}

model Developer {
  id            String     @id @default(cuid())
  name          String     @unique
  description   String?
  logoUrl       String?
  website       String?
  totalProjects Int?       @default(0)
  rating        Float?     @default(0)
  createdAt     DateTime   @default(now())
  updatedAt     DateTime   @updatedAt
  properties    Property[]
}

model Property {
  id                 String            @id @default(cuid())
  title              String
  slug               String            @unique
  description        String
  address            String
  district           String
  city               String
  zipCode            String?
  totalUnits         Int
  availableUnits     Int               @default(0)
  buildingType       BuildingType
  completionDate     DateTime
  moveInDate         DateTime?
  basePrice          BigInt
  pricePerPyeong     BigInt?
  contractDeposit    BigInt
  interimPayments    String
  rightsFee          BigInt?
  profitRate         Float?
  investmentGrade    String?
  constructor        String?
  keyFeature         String?
  totalBuildingCount Int?
  parkingSpaces      Int?
  facilities         String
  status             PropertyStatus    @default(AVAILABLE)
  featured           Boolean           @default(false)
  pdfUrl             String?
  youtubeVideoId     String?
  locationDesc       String?
  pyeongTypes        String?
  subdomain          String?           @unique
  isPremium          Boolean           @default(false)
  seoTitle           String?
  seoDescription     String?
  viewCount          Int               @default(0)
  inquiryCount       Int               @default(0)
  createdAt          DateTime          @default(now())
  updatedAt          DateTime          @updatedAt
  publishedAt        DateTime?
  developerId        String
  authorId           String
  loanRatio          String?
  keyFeatures        String?
  priceDisplay       String?
  investments        Investment[]
  author             User              @relation(fields: [authorId], references: [id])
  developer          Developer         @relation(fields: [developerId], references: [id])
  images             PropertyImage[]
  inquiries          PropertyInquiry[]
  favorites          Favorite[]
  viewHistory        ViewHistory[]

  @@index([status, featured])
  @@index([district, city])
  @@index([basePrice])
}

model PropertyImage {
  id         String    @id @default(cuid())
  url        String
  alt        String?
  caption    String?
  order      Int       @default(0)
  type       ImageType @default(EXTERIOR)
  createdAt  DateTime  @default(now())
  propertyId String
  property   Property  @relation(fields: [propertyId], references: [id], onDelete: Cascade)

  @@index([propertyId, order])
}

model PropertyInquiry {
  id          String        @id @default(cuid())
  name        String
  email       String
  phone       String?
  message     String
  inquiryType InquiryType   @default(GENERAL)
  status      InquiryStatus @default(PENDING)
  source      String?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  respondedAt DateTime?
  propertyId  String
  userId      String?
  property    Property      @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  user        User?         @relation(fields: [userId], references: [id])

  @@index([status, createdAt])
}

model Investment {
  id               String   @id @default(cuid())
  currentValue     BigInt
  projectedValue   BigInt
  profitAmount     BigInt
  profitRate       Float
  investmentPeriod Int
  riskLevel        String
  marketAnalysis   String
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt
  propertyId       String
  property         Property @relation(fields: [propertyId], references: [id], onDelete: Cascade)
}

model AuctionItem {
  id                     String            @id @default(cuid())
  caseNumber             String            @unique
  caseNumberFull         String?
  courtCode              String?
  courtName              String?
  pnu                    String?
  address                String
  addressDetail          String?
  city                   String
  district               String
  itemType               AuctionItemType
  landArea               Float?
  buildingArea           Float?
  floor                  String?
  appraisalPrice         BigInt
  minimumPrice           BigInt
  minimumRate            Int?
  deposit                BigInt?
  saleDate               DateTime?
  saleTime               String?
  bidCount               Int               @default(0)
  bidEndDate             DateTime?
  referenceDate          DateTime?
  hasRisk                Boolean           @default(false)
  riskNote               String?
  owner                  String?
  debtor                 String?
  creditor               String?
  status                 AuctionStatus     @default(SCHEDULED)
  featured               Boolean           @default(false)
  realPrice              BigInt?
  buildingInfo           String?
  naverComplexId         String?
  seoTitle               String?
  seoDescription         String?
  viewCount              Int               @default(0)
  inquiryCount           Int               @default(0)
  createdAt              DateTime          @default(now())
  updatedAt              DateTime          @updatedAt
  appraisalDate          DateTime?
  appraisalOrg           String?
  approvalDate           DateTime?
  buildingAppraisalPrice BigInt?
  buildingStructure      String?
  buildingUsage          String?
  facilities             String?
  heatingType            String?
  landAppraisalPrice     BigInt?
  landUseZone            String?
  locationNote           String?
  nearbyFacilities       String?
  preservationDate       DateTime?
  surroundings           String?
  totalFloors            String?
  transportation         String?
  bids                   AuctionBid[]
  images                 AuctionImage[]
  registers              AuctionRegister[]
  tenants                AuctionTenant[]
  favorites              Favorite[]
  viewHistory            ViewHistory[]

  @@index([status, saleDate])
  @@index([city, district])
  @@index([itemType])
  @@index([pnu])
}

model AuctionBid {
  id           String           @id @default(cuid())
  itemId       String
  round        Int
  bidDate      DateTime?
  minimumPrice BigInt
  result       AuctionBidResult
  winningPrice BigInt?
  bidderCount  Int?
  createdAt    DateTime         @default(now())
  item         AuctionItem      @relation(fields: [itemId], references: [id], onDelete: Cascade)

  @@index([itemId, round])
}

model AuctionRegister {
  id           String      @id @default(cuid())
  itemId       String
  registerType String?
  registerNo   String?
  receiptDate  DateTime?
  purpose      String?
  rightHolder  String?
  claimAmount  BigInt?
  isReference  Boolean     @default(false)
  willExpire   Boolean     @default(true)
  note         String?
  createdAt    DateTime    @default(now())
  item         AuctionItem @relation(fields: [itemId], references: [id], onDelete: Cascade)

  @@index([itemId])
}

model AuctionTenant {
  id            String      @id @default(cuid())
  itemId        String
  tenantName    String?
  hasPriority   Boolean?
  occupiedPart  String?
  moveInDate    DateTime?
  fixedDate     DateTime?
  hasBidRequest Boolean?
  deposit       BigInt?
  monthlyRent   BigInt?
  analysis      String?
  note          String?
  createdAt     DateTime    @default(now())
  item          AuctionItem @relation(fields: [itemId], references: [id], onDelete: Cascade)

  @@index([itemId])
}

model AuctionImage {
  id          String           @id @default(cuid())
  itemId      String
  imageType   AuctionImageType
  url         String
  originalUrl String?
  alt         String?
  order       Int              @default(0)
  createdAt   DateTime         @default(now())
  item        AuctionItem      @relation(fields: [itemId], references: [id], onDelete: Cascade)

  @@index([itemId, order])
}

model Subscription {
  id                     String                    @id @default(cuid())
  houseManageNo          String                    @unique
  pblancNo               String
  houseName              String
  houseType              String
  houseDetailType        String
  address                String
  addressDetail          String?
  zipCode                String?
  region                 String
  regionCode             String?
  latitude               Float?
  longitude              Float?
  totalHouseholds        Int
  recruitDate            DateTime?
  receptionStart         DateTime?
  receptionEnd           DateTime?
  specialSupplyDate      DateTime?
  rank1Date              DateTime?
  rank2Date              DateTime?
  winnerAnnouncementDate DateTime?
  contractStart          DateTime?
  contractEnd            DateTime?
  moveInDate             String?
  developer              String?
  contractor             String?
  modelHousePhone        String?
  homepage               String?
  noticeUrl              String?
  avgPrice               Int?
  avgPricePerPyeong      Int?
  minPrice               Int?
  maxPrice               Int?
  status                 SubscriptionStatus        @default(UPCOMING)
  isHot                  Boolean                   @default(false)
  viewCount              Int                       @default(0)
  rawData                Json?
  createdAt              DateTime                  @default(now())
  updatedAt              DateTime                  @updatedAt
  asilId                 String?
  housingTypes           SubscriptionHousingType[]
  images                 SubscriptionImage[]
  favorites              Favorite[]
  viewHistory            ViewHistory[]

  @@index([houseManageNo])
  @@index([status])
  @@index([region])
  @@index([receptionStart])
}

model SubscriptionImage {
  id             String                    @id @default(cuid())
  subscriptionId String
  category       SubscriptionImageCategory
  url            String
  originalUrl    String?
  alt            String?
  order          Int                       @default(0)
  createdAt      DateTime                  @default(now())
  subscription   Subscription              @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)

  @@index([subscriptionId, category, order])
}

model SubscriptionHousingType {
  id                String       @id @default(cuid())
  subscriptionId    String
  houseTy           String
  modelNo           String?
  supplyArea        Float
  exclusiveArea     Float?
  totalHouseholds   Int
  generalHouseholds Int
  specialHouseholds Int
  topPrice          Int?
  pricePerPyeong    Int?
  rawData           Json?
  createdAt         DateTime     @default(now())
  subscription      Subscription @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)

  @@unique([subscriptionId, houseTy])
  @@index([subscriptionId])
}

// 관심 매물
model Favorite {
  id             String        @id @default(cuid())
  userId         String
  itemType       FavoriteType
  propertyId     String?
  subscriptionId String?
  auctionId      String?
  createdAt      DateTime      @default(now())
  user           User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  property       Property?     @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  subscription   Subscription? @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)
  auction        AuctionItem?  @relation(fields: [auctionId], references: [id], onDelete: Cascade)

  @@unique([userId, itemType, propertyId])
  @@unique([userId, itemType, subscriptionId])
  @@unique([userId, itemType, auctionId])
  @@index([userId, createdAt])
}

// 최근 본 매물
model ViewHistory {
  id             String        @id @default(cuid())
  userId         String
  itemType       FavoriteType
  propertyId     String?
  subscriptionId String?
  auctionId      String?
  viewedAt       DateTime      @default(now())
  user           User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  property       Property?     @relation(fields: [propertyId], references: [id], onDelete: Cascade)
  subscription   Subscription? @relation(fields: [subscriptionId], references: [id], onDelete: Cascade)
  auction        AuctionItem?  @relation(fields: [auctionId], references: [id], onDelete: Cascade)

  @@index([userId, viewedAt])
}

enum FavoriteType {
  PROPERTY
  SUBSCRIPTION
  AUCTION
}

enum UserRole {
  USER
  ADMIN
}

enum PostCategory {
  NEWS
  REAL_ESTATE
  AI_TECH
  BLOCKCHAIN
  MARKET_ANALYSIS
}

enum PostStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum PropertyStatus {
  AVAILABLE
  SOLD_OUT
  COMING_SOON
  SUSPENDED
}

enum BuildingType {
  APARTMENT
  OFFICETEL
  KNOWLEDGE_INDUSTRY
  COMMERCIAL
  SPECIAL
  VILLA
  TOWNHOUSE
}

enum ImageType {
  EXTERIOR
  INTERIOR
  FLOOR_PLAN
  SITE_PLAN
  AMENITY
}

enum InquiryType {
  GENERAL
  VIEWING
  INVESTMENT
  CONSULTATION
}

enum InquiryStatus {
  PENDING
  RESPONDED
  CLOSED
}

enum AuctionItemType {
  APARTMENT
  VILLA
  OFFICETEL
  HOUSE
  COMMERCIAL
  LAND
  FACTORY
  BUILDING
  OTHER
}

enum AuctionStatus {
  SCHEDULED
  BIDDING
  SUCCESSFUL
  FAILED
  WITHDRAWN
  CANCELED
}

enum AuctionBidResult {
  FAILED
  SUCCESSFUL
  WITHDRAWN
  POSTPONED
}

enum AuctionImageType {
  PHOTO
  SURVEY
  APPRAISAL
  REGISTER
  OTHER
}

enum SubscriptionStatus {
  UPCOMING
  OPEN
  CLOSED
  ANNOUNCED
  CONTRACTED
  COMPLETED
}

enum SubscriptionImageCategory {
  MODELHOUSE
  LOCATION
  LAYOUT
  UNIT_LAYOUT
  FLOORPLAN
  GALLERY
  NOTICE_PDF
  PREMIUM
  COMMUNITY
}
